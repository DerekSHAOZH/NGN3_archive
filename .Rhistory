library(dplyr)
library(tidyr)
library(ggplot2)
library(venn)
library(tximport)
library(patchwork)
library(rtracklayer)
library(ggpolypath)
library(purrr)
library(scico)
library(colorspace)
library(RColorBrewer)
library(pheatmap)
library(conflicted)
library(cluster)
library(factoextra)
library(DESeq2)
library(tidyverse)
library(ggprism)
library(rstatix)
library(ggpubr)
library(scales)
conflict_prefer("select", "dplyr")
conflict_prefer("filter", "dplyr")
# all_dire <- "/project/Neurodifferentiation_System/Analysis_NGN3/IsoSwitchAnalyser/GenesWithSwitches/"
all_dire <- "/project/Neurodifferentiation_System/owlmayerTemporary/derek/isoSwitch/Results/"
# filt_dire <- "/project/Neurodifferentiation_System/Analysis_NGN3/IsoSwitchAnalyser/FilteredMain/"
# data_fn <- "/project/Neurodifferentiation_System/Analysis_NGN3/IsoSwitchAnalyser/Results/switchSummary.csv"
data_fn = "/project/Neurodifferentiation_System/owlmayerTemporary/derek/isoSwitch/Results/switch_summary.csv"
DE_fn <- '/project/Neurodifferentiation_System/Analysis_NGN3/DEseq_genes/Results/DE_at_any_timepoint.txt'
event_fn <- "/project/Neurodifferentiation_System/owlmayerTemporary/derek/isoSwitch/Results/AS_type_summary.csv"
#ref_fn <- "/project/Neurodifferentiation_System/Analysis_NGN3/RSEM/Results/OJ63.isoforms.results"
#ref_fn <- "/project/Neurodifferentiation_System/Analysis_NGN3/RSEM/Tables/RSEM_isoform_TPM_shortreads_byDay.csv"
ref_fn <- '/project/owlmayer/Applications/06_IsoformPipeline/data/genomeGencode/gencode.v28.annotation.gtf'
plot_dir_out <- "/project/Neurodifferentiation_System/owlmayerTemporary/derek/isoSwitch/Plots/"
res_dir_out <- '/project/Neurodifferentiation_System/owlmayerTemporary/derek/isoSwitch/Results/'
days<-c(0,1,2,3,5)
###0.Data preparation ####
ctrl <- sapply(days[1:4], function(x){y <- paste0("day", x)})
cond <- sapply(days[2:5], function(x){y <- paste0("day", x)})
#load short-read switch summary ####
# data <- read.csv(data_fn, sep = "\t")
data <- read.csv(data_fn)
#filter significant isoform switches
data <- data[abs(data$dIF) > 0.1 & data$isoform_switch_q_value < 0.05, ]
#filter significant isoform switches
data <- data[abs(data$dIF) > 0.1 & data$isoform_switch_q_value < 0.05, ]
View(data)
#gtf annotation file
gtf <- rtracklayer::import(ref_fn)
gtf_df=as.data.frame(gtf)
gtf_df <- gtf_df %>% filter(type == 'transcript')
gtf_df <- gtf_df[-which(grepl('PAR_Y', gtf_df$gene_id, fixed = T)), ]
ref <- gtf_df %>% dplyr::select(gene_id, gene_name, gene_type)
ref <- ref[!duplicated(ref$gene_name), ]
all_dat <- data %>% left_join(ref, by = "gene_name")
View(all_dat)
background_gene <- read.csv("/project/Neurodifferentiation_System/owlmayerTemporary/derek/isoSwitch/Results/isoformswitchanalyzer_prefilter_gene.csv", row.names = 1)
background_gene <- background_gene$x
background_ref <- ref%>% filter(gene_name %in% background_gene)
#total number of background genes used in isoformswitchanalyzer: 14655
length(unique(background_ref$gene_id))
##genes with transcript usage changes in background genes ####
background_data <- data %>% left_join(background_ref, by = "gene_name")
T %in% is.na(background_data$gene_id.y)
# background_data <- background_data[!is.na(background_data$gene_id.y), ]
#number of genes with significant isoform switch from any timepoint: 9291
length(unique(background_data$gene_id.y))
#number of isoform with significant switch events: 23930
length(unique(background_data$isoform_id))
#number of significant isoform switch events: 69344
length(background_data$isoform_id)
